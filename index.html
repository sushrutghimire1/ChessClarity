<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
    <script src="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>


    <title>Chess Clarity - Discover How You Think in Chess</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #334155;
            background: #ffffff;
        }

        /* Mobile-first responsive design */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Step indicator */
        .step-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .progress-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            border-radius: 2px;
            transition: width 0.8s ease;
            width: 0%;
        }

        .step-text {
            text-align: center;
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        /* Screens */
        .screen {
            min-height: 100vh;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 6rem 1rem 2rem;
            position: relative;
        }

        .screen.active {
            display: flex;
        }

        /* Welcome Screen */
        .welcome-screen {
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
            text-align: center;
        }

        .mascot {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3);
            position: relative;
        }

        .mascot::before {
            content: "‚ôî";
            font-size: 3rem;
            color: white;
        }

        .mascot::after {
            content: "‚≠ê";
            position: absolute;
            top: -8px;
            right: -8px;
            background: #f59e0b;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.1;
            color: #1e293b;
        }

        .highlight {
            background: linear-gradient(135deg, #10b981, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: clamp(1.125rem, 3vw, 1.5rem);
            color: #64748b;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            min-height: 56px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #374151;
            border: 2px solid #d1d5db;
        }

        .btn-secondary:hover {
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        /* Input Screen */
        .input-screen {
            background: linear-gradient(135deg, #fefefe 0%, #f0f9ff 100%);
        }

        .input-container {
            width: 100%;
            max-width: 500px;
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .input-tabs {
            display: flex;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 2rem;
        }

        .tab {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .tab.active {
            background: white;
            color: #10b981;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Chess Board */
        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1px;
            background: #374151;
            border-radius: 8px;
            overflow: hidden;
            margin: 1rem 0;
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }

        .chess-square {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .chess-square.light {
            background: #f0d9b5;
        }

        .chess-square.dark {
            background: #b58863;
        }

        .chess-square:hover {
            background: #10b981 !important;
        }

        .chess-square.highlight {
            background: #fbbf24 !important;
        }

        /* Analysis Screen */
        .analysis-screen {
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        }

        .analysis-container {
            width: 100%;
            max-width: 800px;
            text-align: center;
        }

        .analysis-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-steps {
            text-align: left;
            margin: 2rem 0;
        }

        .analysis-step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .analysis-step.active {
            opacity: 1;
        }

        .analysis-step.completed {
            opacity: 1;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .step-icon.processing {
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .step-icon.completed {
            background: #059669;
        }

        .step-icon.pending {
            background: #9ca3af;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Results Screen */
        .results-screen {
            background: linear-gradient(135deg, #f8fafc 0%, #f0f9ff 100%);
        }

        .results-container {
            width: 100%;
            max-width: 900px;
        }

        .insight-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .insight-main {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }

        .radar-chart {
            width: 250px;
            height: 250px;
            margin: 2rem auto;
            position: relative;
        }

        .radar-chart svg {
            width: 100%;
            height: 100%;
        }

        .heatmap {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .heatmap-cell {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .heatmap-cell.high {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .heatmap-cell.medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .heatmap-cell.low {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .heatmap-label {
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .heatmap-value {
            font-size: 1.25rem;
            font-weight: bold;
        }

        /* Plan Screen */
        .plan-screen {
            background: linear-gradient(135deg, #fefefe 0%, #f0f9ff 100%);
        }

        .plan-container {
            width: 100%;
            max-width: 700px;
        }

        .plan-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .plan-day {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .day-number {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.125rem;
        }

        .day-content h3 {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #1e293b;
        }

        .day-content p {
            color: #64748b;
            font-size: 0.875rem;
        }

        .duration {
            color: #10b981;
            font-weight: 500;
            font-size: 0.875rem;
            margin-left: auto;
        }

        /* Progress Screen */
        .progress-screen {
            background: linear-gradient(135deg, #f8fafc 0%, #f0f9ff 100%);
        }

        .progress-container {
            width: 100%;
            max-width: 800px;
        }

        .clarity-score {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #3b82f6);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.3);
        }

        .acceleration-chart {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .chart-placeholder {
            height: 200px;
            background: linear-gradient(135deg, #f1f5f9, #e0f2fe);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-style: italic;
        }

        .game-analysis-screen .container {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }


        /* Responsive Design */
        @media (min-width: 640px) {
            .container {
                padding: 0 2rem;
            }
            
            .input-container {
                padding: 3rem;
            }

            .chess-board {
                max-width: 400px;
            }

            .btn {
                padding: 1.25rem 2.5rem;
                font-size: 1.125rem;
            }
        }

        @media (min-width: 768px) {
            .heatmap {
                grid-template-columns: repeat(4, 1fr);
            }

            .plan-card {
                padding: 2.5rem;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .dashboard-header .stats {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .stat-item {
        text-align: center;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: bold;
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--text-muted);
    }

    .clarity-score-color { color: var(--primary-color); }
    .learning-speed-color { color: var(--secondary-color); }
    .day-streak-color { color: #f59e0b; }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .insight-card {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
    }
    
    .card-title {
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .card-title .icon {
        font-size: 1.5rem;
    }

    .card-subtitle {
        color: var(--text-muted);
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
    }
    
    .btn.btn-primary, .btn.btn-secondary {
        width: 100%;
    }

    .learning-progress {
        background: #f8fafc;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    .progress-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .progress-title {
        font-weight: 600;
    }

    .progress-check {
        color: var(--primary-color);
        font-size: 0.875rem;
    }

    .progress-bar-container {
        background: var(--border-color);
        height: 4px;
        border-radius: 2px;
        overflow: hidden;
    }
    
    .progress-bar-fill {
        background: var(--primary-color);
        height: 100%;
        border-radius: 2px;
    }

    .performance-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
    }

    .stat-box {
        text-align: center;
        padding: 1rem;
        border-radius: 8px;
    }

    .stat-box-value {
        font-size: 1.25rem;
        font-weight: bold;
    }

    .stat-box-label {
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    
    .rating-bg { background: #f0f9ff; }
    .rating-bg .stat-box-value { color: var(--secondary-color); }
    .gain-bg { background: #f0fdf4; }
    .gain-bg .stat-box-value { color: var(--primary-color); }
    .winrate-bg { background: #fffbeb; }
    .winrate-bg .stat-box-value { color: #f59e0b; }
    .blunders-bg { background: #fdf2f8; }
    .blunders-bg .stat-box-value { color: #ec4899; }

    .acceleration-card {
        padding: 2rem;
    }
    
    .chart-container {
        position: relative;
        height: 200px;
        background: linear-gradient(135deg, #f8fafc, #f0f9ff);
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }
    
    #dashboardChart {
        width: 100%;
        height: 100%;
        display: block;
    }

    .chart-legend {
        position: absolute;
        top: 10px;
        right: 15px;
        display: flex;
        gap: 15px;
        font-size: 0.75rem;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .legend-line {
        width: 12px;
        height: 3px;
        border-radius: 2px;
    }

    .you-line { background: var(--primary-color); }
    .avg-line { background: var(--border-color); }

    .chart-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
    }

    .summary-box {
        text-align: center;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 8px;
    }

    .summary-value {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .summary-label {
        font-size: 0.875rem;
        color: var(--text-muted);
    }

    .faster-color { color: var(--primary-color); }
    .concepts-color { color: var(--secondary-color); }
    .hours-color { color: #f59e0b; }

    @media (min-width: 576px) {
        .dashboard-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
    }

    @media (min-width: 992px) {
        .dashboard-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .acceleration-card {
            grid-column: span 2;
        }
    }
    </style>
</head>
<body>
    <!-- Step Indicator -->
    <div class="step-indicator">
        <div class="container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-text" id="stepText">Welcome - Let's analyze your chess thinking</div>
        </div>
    </div>

    <!-- Screen 1: Welcome & Promise -->
    <section class="screen welcome-screen active" id="welcomeScreen">
        <div class="container">
            <div class="mascot"></div>
            <h1>The <span class="highlight">Free</span>, Easy & Best Way to Improve Your Chess</h1>
            <p class="subtitle">Discover your unique chess style, fix your weaknesses, and improve faster ‚Äî in just 2 minutes!</p>
    
            <button class="btn btn-primary" onclick="nextScreen()">
                Start Analysis
                <span>‚Üí</span>
            </button>
    
            <!-- <div id="g_id_onload"
                data-client_id="YOUR_GOOGLE_CLIENT_ID"
                data-context="signin"
                data-ux_mode="popup"
                data-callback="handleGoogleLogin"
                data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                data-type="standard"
                data-shape="pill"
                data-theme="outline"
                data-text="sign_in_with"
                data-size="large"
                data-logo_alignment="left">
            </div> -->
        </div>
    </section>
    

    <!-- Dashboard Screen -->
    <!-- <section class="screen dashboard-screen" id="dashboardScreen">
        <div class="container">
            <div class="dashboard-header">
                <h1>Your Chess Clarity Dashboard</h1>
                <p class="subtitle">Track your progress and continue improving</p>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value clarity-score-color">87</div>
                        <div class="stat-label">Clarity Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value learning-speed-color">2.3x</div>
                        <div class="stat-label">Learning Speed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value day-streak-color">7</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                </div>
            </div>
    
            <div class="dashboard-grid">
    
                <div class="insight-card">
                    <h3 class="card-title">
                        <span class="icon">üìä</span>
                        Progress Overview
                    </h3>
                    <div class="radar-chart">
                        <svg viewBox="0 0 200 200">
                            <polygon points="100,20 180,76 152,160 48,160 20,76"
                                     fill="none" stroke="#e2e8f0" stroke-width="2"/>
                            <polygon points="100,40 160,82 140,140 60,140 40,82"
                                     fill="none" stroke="#e2e8f0" stroke-width="1"/>
                            <polygon points="100,28 168,78 135,155 65,132 28,80"
                                     fill="rgba(16, 185, 129, 0.3)" stroke="#10b981" stroke-width="3"/>
                            <text x="100" y="15" text-anchor="middle" font-size="10" fill="#374151" font-weight="600">Tactics</text>
                            <text x="185" y="80" text-anchor="start" font-size="10" fill="#374151" font-weight="600">Strategy</text>
                            <text x="155" y="175" text-anchor="middle" font-size="10" fill="#374151" font-weight="600">Endgame</text>
                            <text x="45" y="175" text-anchor="middle" font-size="10" fill="#374151" font-weight="600">Time</text>
                            <text x="15" y="80" text-anchor="end" font-size="10" fill="#374151" font-weight="600">Adapt</text>
                        </svg>
                    </div>
                </div>
    
                <div class="insight-card">
                    <h3 class="card-title">
                        <span class="icon">üéØ</span>
                        Analyze Recent Games
                    </h3>
                    <p class="card-subtitle">Get personalized feedback on your latest games</p>
                    <button class="btn btn-primary" onclick="showRecentGames()">
                        View Recent Games
                        <span>‚Üí</span>
                    </button>
                </div>
    
                <div class="insight-card">
                    <h3 class="card-title">
                        <span class="icon">üìö</span>
                        Today's Learning
                    </h3>
                    <div class="learning-progress">
                        <div class="progress-info">
                            <span class="progress-title">Pressure-Proof Tactics</span>
                            <span class="progress-check">‚úì</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: 75%;"></div>
                        </div>
                    </div>
                    <button class="btn btn-secondary">Continue Learning</button>
                </div>
    
                <div class="insight-card">
                    <h3 class="card-title">
                        <span class="icon">‚ö°</span>
                        Performance Stats
                    </h3>
                    <div class="performance-stats-grid">
                        <div class="stat-box rating-bg">
                            <div class="stat-box-value">1847</div>
                            <div class="stat-box-label">Current Rating</div>
                        </div>
                        <div class="stat-box gain-bg">
                            <div class="stat-box-value">+89</div>
                            <div class="stat-box-label">This Month</div>
                        </div>
                        <div class="stat-box winrate-bg">
                            <div class="stat-box-value">73%</div>
                            <div class="stat-box-label">Win Rate</div>
                        </div>
                        <div class="stat-box blunders-bg">
                            <div class="stat-box-value">1.8</div>
                            <div class="stat-box-label">Avg Blunders</div>
                        </div>
                    </div>
                </div>
    
                <div class="insight-card acceleration-card">
                    <h3 class="card-title">
                        <span class="icon">üìà</span>
                        Learning Acceleration
                    </h3>
                    <div class="chart-container">
                        <canvas id="dashboardChart"></canvas>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-line you-line"></div>
                                <span>You</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-line avg-line"></div>
                                <span>Average</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-summary">
                        <div class="summary-box">
                            <div class="summary-value faster-color">65%</div>
                            <div class="summary-label">Faster than average</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-value concepts-color">142</div>
                            <div class="summary-label">Concepts mastered</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-value hours-color">12</div>
                            <div class="summary-label">Hours practiced</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section> -->

    <!-- Recent Games Modal -->
    <!-- <div id="recentGamesModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; padding: 2rem;">
        <div style="background: white; border-radius: 16px; max-width: 600px; margin: 0 auto; max-height: 90vh; overflow-y: auto;">
            <div style="padding: 2rem; border-bottom: 1px solid #e2e8f0;">
                <div style="display: flex; justify-content: between; align-items: center;">
                    <h2>Recent Games Analysis</h2>
                    <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0.5rem;">√ó</button>
                </div>
                <p style="color: #64748b; margin-top: 0.5rem;">Select a game to get personalized feedback</p>
            </div>
            <div style="padding: 2rem;">
                <div class="recent-games-list">
                    <div class="game-item" onclick="analyzeGame('game1')" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 1rem; cursor: pointer; transition: all 0.2s ease;">
                        <div style="width: 40px; height: 40px; background: #10b981; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">W</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">vs. ChessMaster2024</div>
                            <div style="color: #64748b; font-size: 0.875rem;">Rapid ‚Ä¢ 10+0 ‚Ä¢ Won by checkmate</div>
                        </div>
                        <div style="color: #64748b; font-size: 0.875rem;">2 hours ago</div>
                    </div>
                    
                    <div class="game-item" onclick="analyzeGame('game2')" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 1rem; cursor: pointer; transition: all 0.2s ease;">
                        <div style="width: 40px; height: 40px; background: #ef4444; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">L</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">vs. TacticalNinja</div>
                            <div style="color: #64748b; font-size: 0.875rem;">Blitz ‚Ä¢ 5+0 ‚Ä¢ Lost on time</div>
                        </div>
                        <div style="color: #64748b; font-size: 0.875rem;">5 hours ago</div>
                    </div>
                    
                    <div class="game-item" onclick="analyzeGame('game3')" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 1rem; cursor: pointer; transition: all 0.2s ease;">
                        <div style="width: 40px; height: 40px; background: #6b7280; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">D</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">vs. StrategicPlayer</div>
                            <div style="color: #64748b; font-size: 0.875rem;">Classical ‚Ä¢ 15+10 ‚Ä¢ Draw by repetition</div>
                        </div>
                        <div style="color: #64748b; font-size: 0.875rem;">1 day ago</div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->

    <!-- Game Analysis Screen -->
    <section class="screen game-analysis-screen" id="gameAnalysisScreen">
        <div class="container">
            <div style="max-width: 1000px; margin: 0 auto;">
                <!-- Header -->
                <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <div>
                        <h1 style="margin-bottom: 0.5rem;">Game Analysis</h1>
                        <p style="color: #64748b;">vs. ChessMaster2024 ‚Ä¢ Rapid 10+0 ‚Ä¢ Won by checkmate</p>
                    </div>
                    <button onclick="backToDashboard()" class="btn btn-secondary">
                        ‚Üê Back to Dashboard
                    </button>
                </div>

                <!-- Game Analysis Content -->
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 2rem; align-items: start;">
                    <!-- Chess Board -->
                    <div class="insight-card" style="padding: 2rem;">
                        <div style="position: relative;">
                            <div id="gameBoard" class="chess-board" style="max-width: 400px; margin: 0 auto 2rem;"></div>
                            
                            <!-- AI Tutor Character -->
                            <div id="tutorCharacter" style="position: absolute; top: -60px; right: -20px; width: 120px; height: 120px; z-index: 10;">
                                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto; position: relative; box-shadow: 0 4px 20px rgba(251, 191, 36, 0.3);">
                                    <!-- Indian/European tutor avatar -->
                                    <div style="font-size: 2rem;">üë®‚Äçüè´</div>
                                </div>
                                
                                <!-- Speech bubble -->
                                <div id="tutorBubble" style="position: absolute; bottom: 90px; left: -80px; background: white; padding: 1.25rem; border-radius: 12px; border: 2px solid #fbbf24; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 280px; opacity: 0; transform: scale(0.8); transition: all 0.3s ease; font-size: 0.8rem; line-height: 1.4; z-index: 20;">
                                    <div style="color: #374151; font-weight: 500;" id="tutorMessage">
                                        Perfect opening choice, Alex! Your analysis shows you score 73% better in Italian Game setups compared to other 1847-rated players.
                                    </div>
                                    <!-- Arrow pointing down -->
                                    <div style="position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 8px solid transparent; border-top-color: #fbbf24;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Game Controls -->
                        <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 1rem;">
                            <button onclick="previousMove()" class="btn btn-secondary" style="padding: 0.5rem 1rem;">‚èÆ Previous</button>
                            <button onclick="nextMove()" class="btn btn-primary" style="padding: 0.5rem 1rem;">Next ‚è≠</button>
                        </div>

                        <!-- Move Navigation -->
                        <div style="text-align: center; color: #64748b; font-size: 0.875rem;">
                            Move <span id="currentMove">1</span> of 42
                        </div>
                    </div>

                    <div class="insight-card">
                        <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.2rem;">üéØ</span>
                            Critical Moments
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <div onclick="goToMove(15)" style="padding: 0.75rem; background: #fef2f2; border-radius: 8px; cursor: pointer; border-left: 4px solid #ef4444;">
                                <div style="font-weight: 600; color: #dc2626;">Move 15: Blunder</div>
                                <div style="font-size: 0.875rem; color: #64748b;">Missed tactical shot</div>
                            </div>
                            <div onclick="goToMove(28)" style="padding: 0.75rem; background: #f0fdf4; border-radius: 8px; cursor: pointer; border-left: 4px solid #10b981;">
                                <div style="font-weight: 600; color: #059669;">Move 28: Excellent</div>
                                <div style="font-size: 0.875rem; color: #64748b;">Beautiful sacrifice</div>
                            </div>
                            <div onclick="goToMove(35)" style="padding: 0.75rem; background: #fffbeb; border-radius: 8px; cursor: pointer; border-left: 4px solid #f59e0b;">
                                <div style="font-weight: 600; color: #d97706;">Move 35: Inaccuracy</div>
                                <div style="font-size: 0.875rem; color: #64748b;">Slower mate found</div>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Panel -->
                    <div style="width: 300px;">
                        <div class="insight-card" style="margin-bottom: 1rem;">
                            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.2rem;">üìä</span>
                                Game Summary
                            </h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div style="text-align: center; padding: 0.75rem; background: #f0fdf4; border-radius: 8px;">
                                    <div style="font-weight: bold; color: #10b981;">94%</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Accuracy</div>
                                </div>
                                <div style="text-align: center; padding: 0.75rem; background: #fef3c7; border-radius: 8px;">
                                    <div style="font-weight: bold; color: #f59e0b;">1</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Blunder</div>
                                </div>
                            </div>
                            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                                <div style="font-size: 0.875rem; color: #374151;">
                                    <strong>Key Insight:</strong> Your tactical awareness was excellent, but you missed a faster mate in the endgame.
                                </div>
                            </div>
                        </div>

                     
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Screen 2: Game Data Input -->
    <section class="screen input-screen" id="inputScreen">
        <div class="container">
            <h1>How should we analyze your play?</h1>
            <p class="subtitle">Choose your preferred method to get started</p>
            
            <div class="input-container fade-in">
                <div class="input-tabs">
                    <button class="tab active" onclick="switchTab('import')">Import Games</button>
                    <button class="tab" onclick="switchTab('play')">Play Positions</button>
                </div>

                <div class="tab-content active" id="importTab">
                    <div class="form-group">
                        <label>Chess.com Username</label>
                        <input type="text" placeholder="Enter your username" id="chesscomUsername">
                    </div>
                    <div class="form-group">
                        <label>Or Lichess Username</label>
                        <input type="text" placeholder="Enter your username" id="lichessUsername">
                    </div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="startAnalysis()">
                        Analyze My Games
                        <span>‚Üí</span>
                    </button>
                    <p style="text-align: center; margin-top: 1rem; font-size: 0.875rem; color: #64748b;">
                        We'll analyze your last 10 games automatically
                    </p>
                </div>

                <div class="tab-content" id="playTab">
                    <p style="text-align: center; margin-bottom: 1.5rem; color: #64748b;">
                        Solve 5 quick positions while we track your thinking patterns
                    </p>
                    <div class="chess-board" id="chessBoard"></div>
                    <div style="text-align: center; margin-top: 1rem;">
                        <div style="font-size: 0.875rem; color: #64748b; margin-bottom: 1rem;">
                            Position 1 of 5: Find the best move for White
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-secondary">Skip Position</button>
                            <button class="btn btn-primary">Submit Move</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Screen 3: Cognitive Pattern Analysis -->
    <section class="screen analysis-screen" id="analysisScreen">
        <div class="container">
            <div class="analysis-container fade-in">
                <h1>Analyzing Your Chess DNA</h1>
                <p class="subtitle">Our AI is discovering how your mind works in chess</p>
                
                <div class="analysis-spinner"></div>
                
                <div class="analysis-steps">
                    <div class="analysis-step active" id="step1">
                        <div class="step-icon processing">1</div>
                        <div>
                            <h3>Pattern Recognition Analysis</h3>
                            <p>Measuring your tactical vision and pattern spotting speed</p>
                        </div>
                    </div>
                    
                    <div class="analysis-step" id="step2">
                        <div class="step-icon pending">2</div>
                        <div>
                            <h3>Decision Quality Assessment</h3>
                            <p>Evaluating your move selection under different time pressures</p>
                        </div>
                    </div>
                    
                    <div class="analysis-step" id="step3">
                        <div class="step-icon pending">3</div>
                        <div>
                            <h3>Adaptation Rate Measurement</h3>
                            <p>Testing how quickly you learn from new chess concepts</p>
                        </div>
                    </div>
                    
                    <div class="analysis-step" id="step4">
                        <div class="step-icon pending">4</div>
                        <div>
                            <h3>Cognitive Profile Creation</h3>
                            <p>Building your personalized chess improvement roadmap</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Screen 4: Instant Feedback Visualization -->
    <section class="screen results-screen" id="resultsScreen">
        <div class="container">
            <div class="results-container fade-in">
                <h1>Your Chess Clarity Profile</h1>
                
                <div class="insight-card">
                    <div class="insight-main">
                        "You think like a tactician but slow down under pressure ‚Äî we can fix that in 7 days."
                    </div>
                    
                        <div class="radar-chart">
                            <svg viewBox="0 0 250 250">
                                <!-- Radar chart background -->
                                <defs>
                                    <pattern id="grid" width="100" height="50" patternUnits="userSpaceOnUse">
                                        <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                                    </pattern>
                                </defs>
                                
                                <!-- Pentagon shape for 5 skills -->
                                <polygon points="125,25 225,95 190,200 60,200 25,95" 
                                        fill="none" stroke="#e2e8f0" stroke-width="2"/>
                                <polygon points="125,50 200,105 175,175 75,175 50,105" 
                                        fill="none" stroke="#e2e8f0" stroke-width="1"/>
                                <polygon points="125,75 175,115 160,150 90,150 75,115" 
                                        fill="none" stroke="#e2e8f0" stroke-width="1"/>
                                
                                <!-- User's actual scores -->
                                <polygon points="125,35 210,100 165,185 85,165 35,100" 
                                        fill="rgba(16, 185, 129, 0.3)" stroke="#10b981" stroke-width="3"/>
                                
                                <!-- Skill labels -->
                                <text x="125" y="20" text-anchor="middle" font-size="12" fill="#374151" font-weight="600">Tactical Vision</text>
                                <text x="230" y="100" text-anchor="start" font-size="12" fill="#374151" font-weight="600">Strategic Planning</text>
                                <text x="195" y="215" text-anchor="middle" font-size="12" fill="#374151" font-weight="600">Endgame Knowledge</text>
                                <text x="55" y="215" text-anchor="middle" font-size="12" fill="#374151" font-weight="600">Time Management</text>
                                <text x="20" y="100" text-anchor="end" font-size="12" fill="#374151" font-weight="600">Adaptability</text>
                            </svg>
                        </div>
                    
                    <div class="heatmap">
                        <div class="heatmap-cell high">
                            <div class="heatmap-label">Opening</div>
                            <div class="heatmap-value">92%</div>
                        </div>
                        <div class="heatmap-cell medium">
                            <div class="heatmap-label">Middlegame</div>
                            <div class="heatmap-value">67%</div>
                        </div>
                        <div class="heatmap-cell low">
                            <div class="heatmap-label">Endgame</div>
                            <div class="heatmap-value">34%</div>
                        </div>
                        <div class="heatmap-cell high">
                            <div class="heatmap-label">Tactics</div>
                            <div class="heatmap-value">88%</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="nextScreen()">
                    See My Learning Plan
                    <span>‚Üí</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Screen 5: Personalized Quick-Learning Plan -->
    <section class="screen plan-screen" id="planScreen">
        <div class="container">
            <div class="plan-container fade-in">
                <h1>Your 7-Day <span class="highlight">Clarity Boost</span> Plan</h1>
                <p class="subtitle">Personalized micro-lessons targeting your highest leverage weaknesses</p>
                
                <div class="plan-card">
                    <div class="plan-day">
                        <div class="day-number">1</div>
                        <div class="day-content">
                            <h3>Pressure-Proof Tactics</h3>
                            <p>Quick tactical drills with decreasing time to build speed under pressure</p>
                        </div>
                        <div class="duration">8 min</div>
                    </div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-day">
                        <div class="day-number">2</div>
                        <div class="day-content">
                            <h3>Endgame Foundation</h3>
                            <p>Essential king & pawn endings with interactive practice positions</p>
                        </div>
                        <div class="duration">12 min</div>
                    </div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-day">
                        <div class="day-number">3</div>
                        <div class="day-content">
                            <h3>Time Allocation Mastery</h3>
                            <p>Learn the 40-30-20-10 rule for optimal time management</p>
                        </div>
                        <div class="duration">10 min</div>
                    </div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-day">
                        <div class="day-number">4</div>
                        <div class="day-content">
                            <h3>Positional Pattern Recognition</h3>
                            <p>Identifying weak squares and pawn structures instantly</p>
                        </div>
                        <div class="duration">15 min</div>
                    </div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-day">
                        <div class="day-number">5</div>
                        <div class="day-content">
                            <h3>Adaptive Thinking</h3>
                            <p>Flexibility drills: switching between tactical and positional modes</p>
                        </div>
                        <div class="duration">11 min</div>
                    </div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-day">
                        <div class="day-number">6</div>
                        <div class="day-content">
                            <h3>Complex Position Analysis</h3>
                            <p>Breaking down complicated middlegame positions systematically</p>
                        </div>
                        <div class="duration">18 min</div>
                    </div>
                </div>
                
                <div class="plan-card">
                    <div class="plan-day">
                        <div class="day-number">7</div>
                        <div class="day-content">
                            <h3>Integration & Assessment</h3>
                            <p>Put it all together with a comprehensive skills test and progress review</p>
                        </div>
                        <div class="duration">20 min</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="nextScreen()">
                        Start My Journey
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Screen 6: Gamified Progress Tracker -->
    <section class="screen progress-screen" id="progressScreen">
        <div class="container">
            <div class="progress-container fade-in">
                <h1>Track Your <span class="highlight">Learning Acceleration</span></h1>
                <p class="subtitle">See your progress with our unique Clarity Score system</p>
                
                <div class="clarity-score">
                    <div class="score-circle">87</div>
                    <h2 style="margin-bottom: 0.5rem; color: #1e293b;">Your Clarity Score</h2>
                    <p style="color: #64748b;">Based on decision quality & adaptability rate</p>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="color: #64748b; font-size: 0.875rem;">This Week</span>
                            <span style="color: #10b981; font-weight: 600;">+12 points</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #64748b; font-size: 0.875rem;">Learning Acceleration</span>
                            <span style="color: #3b82f6; font-weight: 600;">2.3x faster</span>
                        </div>
                    </div>
                </div>
                
                <div class="acceleration-chart">
                    <h3 style="margin-bottom: 1.5rem; text-align: center; color: #1e293b;">Your Learning Acceleration Curve</h3>
                    <div style="position: relative; height: 200px; background: linear-gradient(135deg, #f8fafc, #f0f9ff); border-radius: 8px; overflow: hidden;">
                        <canvas id="accelerationChart" width="800" height="200" style="width: 100%; height: 100%; display: block;"></canvas>
                        <div style="position: absolute; top: 10px; right: 15px; display: flex; gap: 15px; font-size: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 12px; height: 3px; background: #10b981; border-radius: 2px;"></div>
                                <span style="color: #64748b;">You</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 12px; height: 3px; background: #e5e7eb; border-radius: 2px;"></div>
                                <span style="color: #64748b;">Average</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                        <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">65%</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Faster than average</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">142</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Concepts mastered</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">7</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Day streak</div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="goToDashboard()">
                        Go to Dashboard
                        <span>‚Üí</span>
                    </button>
                    <button class="btn btn-secondary" onclick="shareResults()" style="margin-left: 1rem;">
                        Share Results
                    </button>
                </div>
            </div>
        </div>
    </section>

    <script>
        let currentScreen = 0;
        const screens = ['welcomeScreen', 'inputScreen', 'analysisScreen', 'resultsScreen', 'planScreen', 'dashboardScreen'];
        const stepTexts = [
            'Welcome - Let\'s analyze your chess thinking',
            'Data Input - Tell us about your chess experience',
            'AI Analysis - Discovering your cognitive patterns',
            'Results - Your personal chess DNA revealed',
            'Learning Plan - Your path to rapid improvement', 
            'Dashboard - Your chess improvement hub'
        ];

        let currentMove = 0;
        const totalMoves = 42;
        
        // User profile data for personalized feedback
        const userProfile = {
            name: "Alex",
            rating: 1847,
            preferredTimeControl: "rapid",
            weeknessArea: "time pressure",
            strengthArea: "tactical vision",
            averageThinkTime: 18.5, // seconds per move
            blunderRate: 1.8, // per game
            accuracyRate: 87.3, // percentage
            endgameKnowledge: 34, // percentile
            openingRepertoire: 92 // percentile
        };

        let game, gameBoard, moveHistory;

        function analyzeGameFromPGN(pgn, meta) {
            game = new Chess();
            game.load_pgn(pgn);
            moveHistory = game.history();
            game.reset();
            currentMove = 0;

            gameBoard = Chessboard('gameBoard', {
                position: 'start',
                pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png',
                draggable: false
            });

            updateTutorMessage(0);
        }

        // Elaborate, personalized tutor messages with meta-analysis
        const elaborateTutorMessages = [
            {
                move: 1,
                message: `Perfect opening choice, Alex! Your analysis shows you score 73% better in Italian Game setups compared to other 1847-rated players. This move controls the center and aims for quick development - exactly matching your tactical style.`,
                context: "opening_strength"
            },
            {
                move: 5,
                message: `Excellent development pattern! You're moving 2.3 seconds faster than your average of 18.5s per move. However, 67% of players your rating would castle here first. Your courage to delay castling shows your tactical confidence.`,
                context: "time_management"
            },
            {
                move: 8,
                message: `Interesting psychological choice! You're playing into a complex middlegame where your tactical vision (92nd percentile) will shine, but this requires precise calculation. Players with your profile win 78% of such positions.`,
                context: "style_analysis"
            },
            {
                move: 12,
                message: `This pin is vintage Alex! Your pattern recognition fired correctly - you spot pins 47% faster than average. But notice you spent 34 seconds here? That's double your average. The position screams for quick tactical execution.`,
                context: "pattern_recognition"
            },
            {
                move: 15,
                message: `CRITICAL ERROR! Alex, this loses material and goes against your strength profile. Your rapid calculation (top 15% of players) should have caught Nxe5. When under time pressure, you make 3x more errors - we need to work on this!`,
                context: "blunder_analysis"
            },
            {
                move: 18,
                message: `Recovery mode activated! This defensive resource shows your resilience. Your defensive skills rank 89th percentile - much higher than typical tactical players. You're compensating beautifully for the earlier mistake.`,
                context: "compensation"
            },
            {
                move: 22,
                message: `Classic Alex move! You're creating complications where your tactical radar excels. Statistical analysis shows you outperform your rating by 150 points in sharp positions like this. Your opponent should be worried.`,
                context: "sharp_positions"
            },
            {
                move: 28,
                message: `SPECTACULAR SACRIFICE! This is why you're special, Alex. Only 3% of 1800-rated players would find this intuitive piece sacrifice. Your 34th percentile endgame knowledge is irrelevant when you create such beautiful attacks!`,
                context: "brilliancy"
            },
            {
                move: 35,
                message: `Almost perfect, but here's where your endgame gap shows. You found mate in 4, but there's mate in 2! Your endgame study time is 12 minutes per week vs 45 minutes for similar-rated players. Still, 96% accuracy overall!`,
                context: "endgame_weakness"
            },
            {
                move: 40,
                message: `Textbook finish! Your tactical execution scored 94% accuracy this game - that's 12 points higher than your average. The combination of your pattern recognition and calculation created a masterpiece. Time to work on endgames next!`,
                context: "game_summary"
            }
        ];

        // Enhanced move analysis with personal statistics
        function getElaborateMessage(moveNumber) {
            const messageData = elaborateTutorMessages.find(m => m.move === moveNumber);
            if (messageData) {
                return messageData.message;
            }
            
            // Generate contextual message based on move range
            if (moveNumber <= 5) {
                return `Move ${moveNumber}: Your opening preparation shines here! Players at your rating (1847) typically know 73% fewer opening variations than you do.`;
            } else if (moveNumber <= 15) {
                return `Move ${moveNumber}: Good middlegame intuition. Your positional understanding ranks 67th percentile, though you prefer tactical complexity.`;
            } else if (moveNumber <= 25) {
                return `Move ${moveNumber}: This is your comfort zone! Sharp tactical positions where your pattern recognition (92nd percentile) dominates.`;
            } else if (moveNumber <= 35) {
                return `Move ${moveNumber}: Approaching the endgame where you typically struggle. Your endgame knowledge (34th percentile) needs attention.`;
            } else {
                return `Move ${moveNumber}: Final phase execution. Remember, you lose 23% more endgames than players your rating - but your tactical skills compensate!`;
            }
        }

        function adjustTutorBubble() {
            const bubble = document.getElementById('tutorBubble');
            const stepIndicatorBottom = document.querySelector('.step-indicator').getBoundingClientRect().bottom;
            const bubbleRect = bubble.getBoundingClientRect();
            if (bubbleRect.top < stepIndicatorBottom) {
                bubble.style.marginTop = (stepIndicatorBottom - bubbleRect.top + 10) + 'px';
            } else {
                bubble.style.marginTop = '0';
            }
        }



        function drawLearningCurve(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Your learning curve (exponential growth)
            const yourData = [];
            const avgData = [];
            for (let i = 0; i <= 30; i++) {
                const x = (i / 30) * width;
                // Your curve: exponential growth
                const yourY = height - (height * 0.8 * (1 - Math.exp(-i/8)) + Math.sin(i/3) * 10 + Math.random() * 5);
                // Average curve: linear growth
                const avgY = height - (height * 0.6 * (i/30) + Math.random() * 8);
                
                yourData.push({x, y: yourY});
                avgData.push({x, y: avgY});
            }
            
            // Draw average curve
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 3;
            ctx.beginPath();
            avgData.forEach((point, i) => {
                if (i === 0) ctx.moveTo(point.x, point.y);
                else ctx.lineTo(point.x, point.y);
            });
            ctx.stroke();
            
            // Draw your curve
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 4;
            ctx.beginPath();
            yourData.forEach((point, i) => {
                if (i === 0) ctx.moveTo(point.x, point.y);
                else ctx.lineTo(point.x, point.y);
            });
            ctx.stroke();
            
            // Add gradient under your curve
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, 'rgba(16, 185, 129, 0.3)');
            gradient.addColorStop(1, 'rgba(16, 185, 129, 0.05)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            yourData.forEach((point, i) => {
                if (i === 0) ctx.moveTo(point.x, point.y);
                else ctx.lineTo(point.x, point.y);
            });
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            ctx.fill();
        }

        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const stepText = document.getElementById('stepText');
            const progress = ((currentScreen + 1) / screens.length) * 100;
            
            progressFill.style.width = progress + '%';
            stepText.textContent = stepTexts[currentScreen];
        }

        function nextScreen() {
            if(currentScreen === 3){
                window.location.href = "dashboard.html";
            }
            if (currentScreen < screens.length - 1) {
                // Hide current screen
                document.getElementById(screens[currentScreen]).classList.remove('active');
                
                // Show next screen
                currentScreen++;
                const nextScreenElement = document.getElementById(screens[currentScreen]);
                nextScreenElement.classList.add('active');
                nextScreenElement.classList.add('fade-in');
                
                updateProgress();
                
                // Special handling for analysis screen
                if (currentScreen === 2) {
                    startAnalysisAnimation();
                }
            }
        }

        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Generate chess board if play tab is selected
            if (tabName === 'play') {
                generateChessBoard();
            }
        }

        function generateChessBoard() {
            const board = document.getElementById('chessBoard');
            board.innerHTML = '';
            
            // Simple chess position setup
            const pieces = [
                ['‚ôú', '‚ôû', '‚ôù', '‚ôõ', '‚ôö', '‚ôù', '‚ôû', '‚ôú'],
                ['‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü'],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô'],
                ['‚ôñ', '‚ôò', '‚ôó', '‚ôï', '‚ôî', '‚ôó', '‚ôò', '‚ôñ']
            ];
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `chess-square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    square.textContent = pieces[row][col];
                    square.onclick = () => selectSquare(square);
                    board.appendChild(square);
                }
            }
        }

        function selectSquare(square) {
            // Remove previous highlights
            document.querySelectorAll('.chess-square').forEach(s => s.classList.remove('highlight'));
            // Highlight selected square
            square.classList.add('highlight');
        }

        function startAnalysis() {
            const username = document.getElementById('chesscomUsername').value || document.getElementById('lichessUsername').value;
            if (username.trim()) {
                nextScreen();
            } else {
                alert('Please enter your username to continue');
            }
        }

        function startAnalysisAnimation() {
            const steps = ['step1', 'step2', 'step3', 'step4'];
            let currentStep = 0;
            
            const interval = setInterval(() => {
                if (currentStep > 0) {
                    // Mark previous step as completed
                    const prevStep = document.getElementById(steps[currentStep - 1]);
                    prevStep.classList.remove('active');
                    prevStep.classList.add('completed');
                    prevStep.querySelector('.step-icon').classList.remove('processing');
                    prevStep.querySelector('.step-icon').classList.add('completed');
                }
                
                if (currentStep < steps.length) {
                    // Activate current step
                    const step = document.getElementById(steps[currentStep]);
                    step.classList.add('active');
                    step.querySelector('.step-icon').classList.add('processing');
                    step.querySelector('.step-icon').classList.remove('pending');
                    currentStep++;
                } else {
                    // Analysis complete, move to results
                    clearInterval(interval);
                    setTimeout(() => {
                        // Mark last step as completed
                        const lastStep = document.getElementById(steps[steps.length - 1]);
                        lastStep.classList.remove('active');
                        lastStep.classList.add('completed');
                        lastStep.querySelector('.step-icon').classList.remove('processing');
                        lastStep.querySelector('.step-icon').classList.add('completed');
                        
                        setTimeout(nextScreen, 1000);
                    }, 2000);
                }
            }, 3000);
        }

        function goToDashboard() {
            // Hide current screen and show dashboard
            document.getElementById(screens[currentScreen]).classList.remove('active');
            document.getElementById('dashboardScreen').classList.add('active');
            
            // Draw the acceleration chart
            setTimeout(() => {
                drawLearningCurve('dashboardChart');
            }, 100);
        }

        function shareResults() {
            alert('Share functionality would integrate with social media APIs');
        }

        function showRecentGames() {
            document.getElementById('recentGamesModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('recentGamesModal').style.display = 'none';
        }

        function analyzeGame(gameId) {
            closeModal();
            document.getElementById('dashboardScreen').classList.remove('active');
            document.getElementById('gameAnalysisScreen').classList.add('active');
            
            // Initialize game board
            generateGameBoard();
            showTutorMessage(1);
        }

        function backToDashboard() {
            document.getElementById('gameAnalysisScreen').classList.remove('active');
            document.getElementById('dashboardScreen').classList.add('active');
        }

        function generateGameBoard() {
            const board = document.getElementById('gameBoard');
            if (!board) return;
            
            board.innerHTML = '';
            
            // Starting chess position
            const pieces = [
                ['‚ôú', '‚ôû', '‚ôù', '‚ôõ', '‚ôö', '‚ôù', '‚ôû', '‚ôú'],
                ['‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü'],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô'],
                ['‚ôñ', '‚ôò', '‚ôó', '‚ôï', '‚ôî', '‚ôó', '‚ôò', '‚ôñ']
            ];
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `chess-square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    square.textContent = pieces[row][col];
                    board.appendChild(square);
                }
            }
        }

        function showTutorMessage(moveNumber) {
            const bubble = document.getElementById('tutorBubble');
            const message = document.getElementById('tutorMessage');
            
            if (bubble && message) {
                adjustTutorBubbleVisibility();
                const elaborateMessage = getElaborateMessage(moveNumber);
                message.textContent = elaborateMessage;
                bubble.style.opacity = '1';
                bubble.style.transform = 'scale(1)';
                
                // Hide after 8 seconds (longer for elaborate messages)
                setTimeout(() => {
                    bubble.style.opacity = '0';
                    bubble.style.transform = 'scale(0.8)';
                }, 8000);
            }
        }

        function adjustTutorBubbleVisibility() {
            const bubble = document.getElementById('tutorBubble');
            const stepIndicatorBottom = document.querySelector('.step-indicator').getBoundingClientRect().bottom;
            const tutorChar = document.getElementById('tutorCharacter').getBoundingClientRect();

            // Calculate where to center the bubble horizontally over the tutor character
            const bubbleWidth = bubble.offsetWidth;
            const centerX = tutorChar.left + tutorChar.width / 2 - bubbleWidth / 2;

            if (bubble.getBoundingClientRect().top < stepIndicatorBottom + 8) {
                // Fixed positioning if bubble is too high (avoid step bar)
                bubble.style.position = 'fixed';
                bubble.style.top = `${stepIndicatorBottom + 12}px`;
                bubble.style.left = `${Math.max(10, centerX)}px`; // keep at least 10px from left edge
                bubble.style.right = 'auto';
            } else {
                // Absolute positioning inside tutorCharacter
                bubble.style.position = 'absolute';
                bubble.style.bottom = '90px';
                bubble.style.left = `${-(bubbleWidth / 2 - tutorChar.width / 2)}px`;
                bubble.style.right = 'auto';
                bubble.style.top = '';
            }
        }


        function nextMove() {
            if (currentMove < moveHistory.length) {
                game.move(moveHistory[currentMove]);
                gameBoard.position(game.fen());
                currentMove++;
                updateTutorMessage(currentMove);
            }
        }

        function previousMove() {
            if (currentMove > 0) {
                game.undo();
                gameBoard.position(game.fen());
                currentMove--;
                updateTutorMessage(currentMove);
            }
        }

        async function startLatestGameAnalysis() {
            const archives = await fetch('https://api.chess.com/pub/player/sushrutghimire1/games/archives').then(r => r.json());
            const latestArchive = archives.archives.pop();
            const games = await fetch(latestArchive).then(r => r.json());
            const latestGame = games.games[0];
            analyzeGameFromPGN(latestGame.pgn, latestGame);
        }




        function goToMove(moveNumber) {
            currentMove = moveNumber;
            document.getElementById('currentMove').textContent = currentMove;
            
            // Show elaborate message for this specific move
            showTutorMessage(moveNumber);
        }


        function restartFlow() {
            // Reset to first screen
            document.getElementById(screens[currentScreen]).classList.remove('active');
            document.getElementById('dashboardScreen').classList.remove('active');
            document.getElementById('gameAnalysisScreen').classList.remove('active');
            
            currentScreen = 0;
            document.getElementById(screens[currentScreen]).classList.add('active');
            updateProgress();
            
            // Reset form inputs
            document.getElementById('chesscomUsername').value = '';
            document.getElementById('lichessUsername').value = '';
            
            // Reset analysis steps
            document.querySelectorAll('.analysis-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                const icon = step.querySelector('.step-icon');
                icon.classList.remove('processing', 'completed');
                icon.classList.add('pending');
            });
        }

        // Modal click outside to close
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('recentGamesModal');
            if (e.target === modal) {
                closeModal();
            }
        });

        // Game item hover effects
        document.addEventListener('DOMContentLoaded', function() {
            const gameItems = document.querySelectorAll('.game-item');
            gameItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.borderColor = '#10b981';
                    this.style.backgroundColor = '#f0fdf4';
                });
                item.addEventListener('mouseleave', function() {
                    this.style.borderColor = '#e2e8f0';
                    this.style.backgroundColor = 'white';
                });
            });
        });

        // Initialize
        updateProgress();
        generateChessBoard();
        
        // Draw initial chart when page loads
        setTimeout(() => {
            drawLearningCurve('accelerationChart');
        }, 500);


        
    </script>
